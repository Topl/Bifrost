name: Bifrost_CI

on:
  push:
    branches: [tetra-test-docker-workflow]
    tags: ['*']
  workflow_dispatch:

jobs:
  publish-docker-image-dev:
    if: ${{ github.ref_name == 'dev' }}
    uses: ./.github/workflows/_docker_publish.yml
    # needs: sbt-build
    with:
      remote-repository: "us-central1-docker.pkg.dev/topl-shared-project-dev/topl-artifacts-dev"
      registry-auth-location: "us-central1-docker.pkg.dev"
      local-docker-repo: "toplprotocol"
      local-docker-image: "bifrost-node"
    secrets: inherit

  publish-docker-image-dev-tetra:
    if: ${{ github.ref_name == 'tetra-test-docker-workflow' }}
    uses: ./.github/workflows/_docker_publish.yml
    # needs: sbt-build
    with:
      remote-repository: "us-central1-docker.pkg.dev/topl-shared-project-dev/topl-artifacts-dev"
      registry-auth-location: "us-central1-docker.pkg.dev"
      local-docker-repo: "toplprotocol"
      local-docker-image: "bifrost-node-tetra"
      scala-project: "nodeTetra"
    secrets: inherit

  publish-docker-image-qa:
    if: ${{ startsWith(github.ref_name, 'release-') }}
    uses: ./.github/workflows/_docker_publish.yml
    # needs: sbt-build
    with:
      remote-repository: "us-central1-docker.pkg.dev/topl-shared-project-qa/topl-artifacts-qa"
      registry-auth-location: "us-central1-docker.pkg.dev"
      local-docker-repo: "toplprotocol"
      local-docker-image: "bifrost-node"
    secrets: inherit
